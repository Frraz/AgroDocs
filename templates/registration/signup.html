{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="auth-wrap">
  <div class="card auth-card fade-in">
    <div class="auth-brand d-flex align-items-center mb-2">
      <i class="bi bi-person-plus me-2"></i>
      <h1 class="h5 m-0">Criar conta</h1>
    </div>

    {% if form.non_field_errors %}
      <div class="alert alert-danger mb-3">
        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
      </div>
    {% endif %}

    <form method="post" novalidate class="auth-form">
      {% csrf_token %}

      {% if form.first_name %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.first_name.id_for_label }}">{{ form.first_name.label|default:"Nome" }}</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-person"></i></span>
          {{ form.first_name }}
        </div>
        {% for error in form.first_name.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
      </div>
      {% endif %}

      {% if form.username %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.username.id_for_label }}">{{ form.username.label|default:"Usuário" }}</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-at"></i></span>
          {{ form.username }}
        </div>
        {% for error in form.username.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
      </div>
      {% endif %}

      {% if form.email %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.email.id_for_label }}">{{ form.email.label|default:"E-mail" }}</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-envelope"></i></span>
          {{ form.email }}
        </div>
        {% for error in form.email.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
      </div>
      {% endif %}

      {% if form.password1 %}
      <div class="mb-2">
        <label class="form-label" for="{{ form.password1.id_for_label }}">{{ form.password1.label|default:"Senha" }}</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-lock"></i></span>
          {{ form.password1 }}
          <button class="btn btn-outline-secondary" type="button" data-toggle-password="{{ form.password1.auto_id }}">
            <i class="bi bi-eye"></i>
          </button>
        </div>
        <!-- Barra de força -->
        <div class="progress mt-2" style="height:6px;">
          <div class="progress-bar" role="progressbar" style="width:0%;" data-pwd-strength></div>
        </div>
        <div class="form-help mt-1" data-pwd-strength-text>Força da senha</div>

        <!-- Checklist: somente o primeiro é obrigatório; os demais são recomendações -->
        <ul class="password-req small mt-2 list-unstyled" data-pwd-req>
          <li data-req="length"><i class="bi bi-x-circle me-1"></i>Mínimo 8 caracteres (obrigatório)</li>
          <li data-req="lower"><i class="bi bi-x-circle me-1"></i>Usar letras minúsculas (opcional)</li>
          <li data-req="upper"><i class="bi bi-x-circle me-1"></i>Usar letras maiúsculas (opcional)</li>
          <li data-req="digit"><i class="bi bi-x-circle me-1"></i>Usar números (opcional)</li>
          <li data-req="special"><i class="bi bi-x-circle me-1"></i>Usar caractere especial (opcional)</li>
        </ul>
        {% for error in form.password1.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
      </div>
      {% endif %}

      {% if form.password2 %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.password2.id_for_label }}">{{ form.password2.label|default:"Confirmar senha" }}</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-shield-check"></i></span>
          {{ form.password2 }}
          <button class="btn btn-outline-secondary" type="button" data-toggle-password="{{ form.password2.auto_id }}">
            <i class="bi bi-eye"></i>
          </button>
        </div>
        <div class="form-help mt-1 d-none" data-pwd-match>
          <i class="bi bi-check-circle me-1"></i> Senhas coincidem
        </div>
        {% for error in form.password2.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
      </div>
      {% endif %}

      <button class="btn btn-primary w-100" data-submit>
        <span class="label">Cadastrar</span>
        <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
      </button>
    </form>

    <p class="mt-3 mb-0 text-center text-muted small">
      Já tem conta? <a href="{% url 'login' %}">Entrar</a>
    </p>
  </div>
</div>

<script src="{% static 'js/auth.js' %}"></script>
{% endblock %}